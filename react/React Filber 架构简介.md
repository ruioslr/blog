---
title: React Fiber 架构
categories:
 - React
tags:
 - React React源码
---

# React Fiber 架构

React Fiber 是 React 16 引入的一种新的协调（reconciliation）引擎。在此之前，React 使用的是栈协调器（Stack Reconciler）。Fiber 架构的引入，彻底改变了 React 内部处理组件更新的方式，使其能够实现可中断、可恢复、可优先级的渲染，从而显著提升了用户体验，尤其是在大型、复杂或低端设备上的应用。

为什么需要 Fiber 架构？
在 Fiber 之前，React 的协调过程是同步且不可中断的。一旦更新开始，React 就会一口气处理完整个组件树，直到渲染完成。这个过程被称为“栈协调”，因为它类似于函数调用栈的执行方式。

这种同步执行带来了几个问题：

阻塞主线程： 当组件树很大或更新很频繁时，协调过程可能会持续几十甚至上百毫秒。由于 JavaScript 是单线程的，这意味着在这段时间内，主线程被完全占用，浏览器无法响应用户输入（如点击、滚动）或执行动画，导致页面出现卡顿、无响应的“掉帧”现象。
优先级不足： 所有的更新都被一视同仁地处理，无法区分哪些更新更紧急（如用户输入），哪些可以稍后处理（如不重要的动画）。
并发能力受限： 难以实现更复杂的调度策略，比如在完成一项工作前暂停，转而去处理更重要的工作。
为了解决这些问题，React 团队重写了协调器，引入了 Fiber 架构。

Fiber 到底是什么？
Fiber 是 React 内部对工作单元（Work Unit）的重新实现。

你可以将每个 Fiber 节点理解为 React 组件实例的一个普通 JavaScript 对象。它包含了组件的类型、属性（props）、状态（state），以及指向其他 Fiber 节点的指针（父节点、子节点、兄弟节点）。这些指针共同构建了一个 Fiber 树，它实际上就是组件树的运行时表示。

## fiber的核心思想

分片与调度


Fiber 架构的核心就是将这个漫长、同步的协调过程，拆解成一个个小的、独立的‘工作单元’（Fiber）。每个 Fiber 节点实际上就是 React 组件实例在内存中的一个普通 JavaScript 对象，里面包含了组件的类型、props、state，以及指向父子兄弟节点的指针，更重要的是，它记录了当前工作的所有信息，可以随时暂停和恢复